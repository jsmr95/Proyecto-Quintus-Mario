<!DOCTYPE html>
<html lang="es" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no" />
    <title>Prueba Quintus</title>
    <script src="lib/quintus.js"> </script>
    <script src="lib/quintus_scenes.js"> </script>
    <script src="lib/quintus_2d.js"> </script>
    <script src="lib/quintus_sprites.js"> </script>
    <script src="lib/quintus_input.js"> </script>
    <script src="lib/quintus_anim.js"> </script>
    <script src="lib/quintus_touch.js"> </script>
    <script src="lib/quintus_ui.js"> </script>
    <script src="scripts/metodos.js"> </script>
  </head>
  <body>
    <script>
      window.onload = function(){
        var Q = window.Q = Quintus().include("Sprites,Scenes,2D,UI,Touch,Anim,Input")
          .setup({width:380, height:480}).touch();

        //Creo los valores de colisiones
        Q.SPRITE_NONE = 0;
        Q.SPRITE_OTROS = 1;
        Q.SPRITE_PJ = 2;

        //Creamos la escena nivel1
        Q.scene("nivel1",function(stage){
            var colisiones = new Q.TileLayer({dataAsset: "collision.json",sheet:"fondo",type:Q.SPRITE_OTROS});
            var background = new Q.TileLayer({dataAsset: "fondo.json",sheet:"fondo",type:Q.SPRITE_NONE});
            stage.collisionLayer(colisiones);
            stage.insert(background);

            //Creo jugador principal
            var principal = new Q.Sprite({
                x:30,
                y:10,
                sheet:"jugador",
                type:Q.SPRITE_PJ,
                collisionMask: Q.SPRITE_OTROS
            });

            //Añado el viewport
            stage.add("viewport").follow(principal,{x:true,y:true},{minX:0,maxX:background.p.w,minY:0,
            maxY:background.p.h});

            //Agrego evento al personaje
            window.addEventListener("keydown",function(e){
              switch (e.key) {
                case "ArrowRight":
                  principal.p.vx = 430;
                  break;
                case "ArrowLeft":
                  principal.p.vx = -130;
                  break;
                case "ArrowUp":
                  velocidadY(principal);
                  break;
              }
            });

          window.addEventListener("keyup",function(e){
            switch (e.key) {
              case "ArrowRight":
                principal.p.vx = 0;
                break;
              case "ArrowLeft":
                principal.p.vx = 0;
                break;
              case "ArrowUp":
                principal.p.vy = 0;
                break;
            }
          })

          //Creo meta juego
          var meta = new Q.Sprite({
            x:background.p.w - 35,
            y:100,
            gravity: 0,
            sheet:"meta",
            type:Q.SPRITE_OTROS
          });

          //Añado evento a la meta
          meta.on("hit",function(collision){
            if (collision.obj.isA("Sprite")) {
              Q.stageScene("endGame",1);
              this.destroy();
            }
          });

          //Creo la escena al finalizar
          Q.scene("endGame", function(stage){
            var box = new Q.UI.Container({
              x: Q.width/2,
              y: Q.height/3,
              fill: "rgba(0,0,0,0.5)"
            })
            stage.insert(box);
            var button = new Q.UI.Button({
              x:0,
              y:0,
              fill: "#CCCCCC",
              label: "Jugar de nuevo"
            });
            box.insert(button);
            box.fit(20);
            button.on("click",function(){
              Q.stageScene("nivel1",0);
              stage.stop();
            })
          })

          //Añado metodos e inserto
          principal.add('2d');
          meta.add('2d');
          stage.insert(principal);
          stage.insert(meta);
        });

        Q.load("personajes.json,personajes.png,fondo.png, fondo.json,collision.json", function(){
          Q.sheet("fondo","fondo.png", {tilew:32, tileh:32});
          Q.compileSheets("personajes.png","personajes.json");
          Q.stageScene("nivel1",0);
        });
      }
    </script>
  </body>
</html>
